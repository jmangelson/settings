#!/usr/bin/env python

import os
import sys
import re
import commands
from random import randint

COWPATH    = os.getenv('COWPATH')
COWBIN     = '/usr/games/cowsay'
FORTUNEBIN = '/usr/games/fortune'

if COWPATH is None:
    COWPATH = '/usr/share/cowsay/cows/'

def getCow(d = COWPATH):
    cows = os.listdir(d)
    cow = cows[randint(0, len(cows)-1)]
    cowBasename = os.path.basename(cow)
    if re.match('sodomized.*', cowBasename):
        return getCow()
    else:
        return cow

def main():
    if not (os.path.exists(COWBIN) and
            os.path.exists(FORTUNEBIN)):
        return 1
    cow = getCow()
    text = commands.getoutput(' '.join([FORTUNEBIN, '-a |', COWBIN, '-f', cow]))
    print text
    print
    return 0

if __name__ == '__main__':
    sys.exit(main())
